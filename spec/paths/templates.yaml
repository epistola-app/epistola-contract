templates:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63

  get:
    operationId: listTemplates
    summary: List templates for a tenant
    description: Retrieve all document templates belonging to a specific tenant.
    tags:
      - Templates
    x-required-roles: [reader, editor, generator, manager]
    parameters:
      - name: q
        in: query
        description: Search term for filtering templates by name
        schema:
          type: string
    responses:
      '200':
        description: List of templates
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/templates.yaml#/TemplateListResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  post:
    operationId: createTemplate
    summary: Create a new template
    description: Create a new document template for the specified tenant.
    tags:
      - Templates
    x-required-roles: [editor, manager]
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/templates.yaml#/CreateTemplateRequest'
    responses:
      '201':
        description: Template created successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/templates.yaml#/TemplateDto'
      '400':
        description: Invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

templates-id:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50

  get:
    operationId: getTemplate
    summary: Get template by ID
    description: Retrieve details of a specific document template including its model and data examples.
    tags:
      - Templates
    x-required-roles: [reader, editor, generator, manager]
    responses:
      '200':
        description: Template details
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/templates.yaml#/TemplateDto'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  patch:
    operationId: updateTemplate
    summary: Update a template
    description: Update an existing document template's properties, model, or data examples.
    tags:
      - Templates
    x-required-roles: [editor, manager]
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/templates.yaml#/UpdateTemplateRequest'
    responses:
      '200':
        description: Template updated successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/templates.yaml#/TemplateDto'
      '400':
        description: Invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  delete:
    operationId: deleteTemplate
    summary: Delete a template
    description: Delete a document template.
    tags:
      - Templates
    x-required-roles: [manager]
    responses:
      '204':
        description: Template deleted successfully
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

template-validate:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50

  post:
    operationId: validateTemplateData
    summary: Validate template input data
    description: |
      Validate input data against the template's JSON Schema before submitting a generation job.
      This endpoint provides pre-flight validation to catch schema violations early, enabling
      faster feedback during development and before batch submission.
    tags:
      - Templates
    x-required-roles: [reader, editor, generator, manager]
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/validation.yaml#/ValidateTemplateDataRequest'
    responses:
      '200':
        description: Validation completed (check the 'valid' field for result)
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/validation.yaml#/TemplateDataValidationResult'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Template or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'
