versions:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: variantId
      in: path
      required: true
      description: Slug identifier of the variant
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50

  get:
    operationId: listVersions
    summary: List versions for a variant
    description: Retrieve all versions of a specific variant (draft, published, archived).
    tags:
      - Versions
    x-required-roles: [reader, editor, generator, manager]
    parameters:
      - name: status
        in: query
        description: Filter by lifecycle status
        schema:
          type: string
          enum:
            - draft
            - published
            - archived
    responses:
      '200':
        description: List of versions
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionListResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

versions-id:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: variantId
      in: path
      required: true
      description: Slug identifier of the variant
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: versionId
      in: path
      required: true
      description: Version identifier (version number, 1-200)
      schema:
        type: integer
        minimum: 1
        maximum: 200

  get:
    operationId: getVersion
    summary: Get version by ID
    description: Retrieve details of a specific version including its template model.
    tags:
      - Versions
    x-required-roles: [reader, editor, generator, manager]
    responses:
      '200':
        description: Version details
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Version, variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

  patch:
    operationId: updateVersion
    summary: Update a draft version
    description: Update the template model of a draft version. Only drafts can be updated.
    tags:
      - Versions
    x-required-roles: [editor, manager]
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/versions.yaml#/UpdateDraftRequest'
    responses:
      '200':
        description: Version updated successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '400':
        description: Invalid request or version is not a draft
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Version, variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

version-publish:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: variantId
      in: path
      required: true
      description: Slug identifier of the variant
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: versionId
      in: path
      required: true
      description: Version identifier (version number, 1-200)
      schema:
        type: integer
        minimum: 1
        maximum: 200

  post:
    operationId: publishVersion
    summary: Publish a version to an environment
    description: |
      Publish a version to a target environment. If the version is a draft, it freezes the content
      (status changes to 'published'). If already published, the version status is unchanged.
      Archived versions cannot be published.

      This single action replaces the previous separate publish + activate workflow.
    tags:
      - Versions
    x-required-roles: [editor, manager]
    requestBody:
      required: true
      content:
        application/vnd.epistola.v1+json:
          schema:
            $ref: '../components/schemas/versions.yaml#/PublishVersionRequest'
    responses:
      '200':
        description: Version published to environment
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '400':
        description: Version is archived or invalid request
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Version, variant, template, environment, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'

version-archive:
  parameters:
    - name: tenantId
      in: path
      required: true
      description: Unique slug identifier of the tenant (e.g., "acme-corp")
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 63
    - name: templateId
      in: path
      required: true
      description: Slug identifier of the template
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: variantId
      in: path
      required: true
      description: Slug identifier of the variant
      schema:
        type: string
        pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
        minLength: 3
        maxLength: 50
    - name: versionId
      in: path
      required: true
      description: Version identifier (version number, 1-200)
      schema:
        type: integer
        minimum: 1
        maximum: 200

  post:
    operationId: archiveVersion
    summary: Archive a published version
    description: |
      Archive a published version. Archived versions are kept for history but cannot be
      activated in any environment. Any active deployments using this version will need
      to be updated to use a different version.
    tags:
      - Versions
    x-required-roles: [editor, manager]
    responses:
      '200':
        description: Version archived successfully
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/schemas/versions.yaml#/VersionDto'
      '400':
        description: Version is not published (cannot archive drafts or already archived)
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ValidationErrorResponse'
      '401':
        $ref: '../components/responses/auth-errors.yaml#/UnauthorizedError'
      '403':
        $ref: '../components/responses/auth-errors.yaml#/ForbiddenError'
      '404':
        description: Version, variant, template, or tenant not found
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'
      '409':
        description: Version is still active in one or more environments
        content:
          application/vnd.epistola.v1+json:
            schema:
              $ref: '../components/responses/errors.yaml#/ErrorResponse'
