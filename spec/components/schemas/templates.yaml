TemplateDto:
  type: object
  description: Full document template with all details including variant summaries
  required:
    - id
    - tenantId
    - name
    - variants
    - createdAt
    - lastModified
  properties:
    id:
      type: string
      pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
      minLength: 3
      maxLength: 50
      description: Slug identifier of the template (e.g., "monthly-invoice")
      example: invoice
    tenantId:
      type: string
      pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
      minLength: 3
      maxLength: 63
      description: Slug identifier of the tenant this template belongs to
      example: acme-corp
    name:
      type: string
      description: Name of the template
      example: Monthly Invoice
    schema:
      type: object
      description: JSON Schema defining the input parameters for this template
      example:
        type: object
        required:
          - customer
          - invoiceNumber
          - issueDate
          - lineItems
        properties:
          customer:
            type: object
            required:
              - name
              - email
            properties:
              name:
                type: string
                minLength: 1
                maxLength: 200
              email:
                type: string
                format: email
              taxId:
                type: string
                pattern: "^[A-Z]{2}\\d{9}$"
              address:
                type: object
                properties:
                  street:
                    type: string
                  city:
                    type: string
                  postalCode:
                    type: string
                    pattern: "^\\d{5}(-\\d{4})?$"
                  country:
                    type: string
                    enum: [US, GB, NL, DE, FR]
          invoiceNumber:
            type: string
            pattern: "^INV-\\d{4}-\\d{3}$"
          issueDate:
            type: string
            format: date
          dueDate:
            type: string
            format: date
          lineItems:
            type: array
            minItems: 1
            items:
              type: object
              required:
                - description
                - quantity
                - unitPrice
              properties:
                description:
                  type: string
                quantity:
                  type: integer
                  minimum: 1
                unitPrice:
                  type: number
                  minimum: 0
                taxRate:
                  type: number
                  minimum: 0
                  maximum: 100
          notes:
            type: string
            maxLength: 1000
          currency:
            type: string
            enum: [USD, EUR, GBP]
            default: USD
    dataModel:
      type: object
      description: JSON Schema defining the expected data structure for template rendering
      example:
        type: object
        properties:
          header:
            type: object
            properties:
              logo:
                type: string
                format: uri
              companyName:
                type: string
              companyAddress:
                type: object
                properties:
                  street:
                    type: string
                  city:
                    type: string
                  postalCode:
                    type: string
                  country:
                    type: string
          summary:
            type: object
            properties:
              subtotal:
                type: number
              taxTotal:
                type: number
              total:
                type: number
          lineItems:
            type: array
            items:
              type: object
              properties:
                description:
                  type: string
                quantity:
                  type: integer
                unitPrice:
                  type: number
                lineTotal:
                  type: number
          footer:
            type: object
            properties:
              paymentTerms:
                type: string
              bankDetails:
                type: object
                properties:
                  iban:
                    type: string
                  bic:
                    type: string
    dataExamples:
      type: array
      description: Example data sets for testing template rendering
      items:
        $ref: '#/DataExampleDto'
    variants:
      type: array
      description: Summary of all variants for this template
      items:
        $ref: './variants.yaml#/VariantSummaryDto'
    createdAt:
      type: string
      format: date-time
      description: Timestamp when the template was created
      example: "2026-01-20T09:00:00Z"
    lastModified:
      type: string
      format: date-time
      description: Timestamp when the template was last modified
      example: "2026-01-22T16:45:00Z"
  example:
    id: invoice
    tenantId: acme-corp
    name: Monthly Invoice
    schema:
      type: object
      required:
        - customer
        - invoiceNumber
        - issueDate
        - lineItems
      properties:
        customer:
          type: object
          required:
            - name
            - email
          properties:
            name:
              type: string
              minLength: 1
              maxLength: 200
            email:
              type: string
              format: email
            taxId:
              type: string
              pattern: "^[A-Z]{2}\\d{9}$"
            address:
              type: object
              properties:
                street:
                  type: string
                city:
                  type: string
                postalCode:
                  type: string
                  pattern: "^\\d{5}(-\\d{4})?$"
                country:
                  type: string
                  enum: [US, GB, NL, DE, FR]
        invoiceNumber:
          type: string
          pattern: "^INV-\\d{4}-\\d{3}$"
        issueDate:
          type: string
          format: date
        dueDate:
          type: string
          format: date
        lineItems:
          type: array
          minItems: 1
          items:
            type: object
            required:
              - description
              - quantity
              - unitPrice
            properties:
              description:
                type: string
              quantity:
                type: integer
                minimum: 1
              unitPrice:
                type: number
                minimum: 0
              taxRate:
                type: number
                minimum: 0
                maximum: 100
        notes:
          type: string
          maxLength: 1000
        currency:
          type: string
          enum: [USD, EUR, GBP]
          default: USD
    dataModel:
      type: object
      properties:
        header:
          type: object
          properties:
            logo:
              type: string
              format: uri
            companyName:
              type: string
            companyAddress:
              type: object
        summary:
          type: object
          properties:
            subtotal:
              type: number
            taxTotal:
              type: number
            total:
              type: number
        lineItems:
          type: array
          items:
            type: object
            properties:
              description:
                type: string
              quantity:
                type: integer
              unitPrice:
                type: number
              lineTotal:
                type: number
        footer:
          type: object
          properties:
            paymentTerms:
              type: string
            bankDetails:
              type: object
    dataExamples:
      - id: standard-invoice
        name: Standard Invoice
        data:
          customer:
            name: "Jane Smith"
            email: "jane.smith@example.com"
            taxId: "US123456789"
            address:
              street: "123 Main Street"
              city: "Springfield"
              postalCode: "62704"
              country: US
          invoiceNumber: "INV-2026-001"
          issueDate: "2026-02-01"
          dueDate: "2026-03-01"
          lineItems:
            - description: "Consulting Services (40h)"
              quantity: 40
              unitPrice: 150.00
              taxRate: 21
            - description: "Software License - Enterprise"
              quantity: 1
              unitPrice: 2500.00
              taxRate: 21
            - description: "Travel Expenses"
              quantity: 1
              unitPrice: 384.50
              taxRate: 0
          notes: "Payment due within 30 days. Please reference invoice number on transfer."
          currency: EUR
      - id: minimal-invoice
        name: Minimal Invoice (required fields only)
        data:
          customer:
            name: "Bob Johnson"
            email: "bob@example.com"
          invoiceNumber: "INV-2026-002"
          issueDate: "2026-02-15"
          lineItems:
            - description: "One-time setup fee"
              quantity: 1
              unitPrice: 500.00
    variants:
      - id: english
        title: English Invoice
        attributes:
          locale: en-US
          brand: acme
        isDefault: false
        hasDraft: true
        publishedVersions: [1, 2]
    createdAt: "2026-01-20T09:00:00Z"
    lastModified: "2026-01-22T16:45:00Z"

TemplateSummaryDto:
  type: object
  description: Summary view of a template for list displays
  required:
    - id
    - tenantId
    - name
    - createdAt
    - lastModified
  properties:
    id:
      type: string
      pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
      minLength: 3
      maxLength: 50
      description: Slug identifier of the template (e.g., "monthly-invoice")
      example: invoice
    tenantId:
      type: string
      pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
      minLength: 3
      maxLength: 63
      description: Slug identifier of the tenant this template belongs to
      example: acme-corp
    name:
      type: string
      description: Name of the template
      example: Monthly Invoice
    createdAt:
      type: string
      format: date-time
      description: Timestamp when the template was created
      example: "2026-01-20T09:00:00Z"
    lastModified:
      type: string
      format: date-time
      description: Timestamp when the template was last modified
      example: "2026-01-22T16:45:00Z"
  example:
    id: invoice
    tenantId: acme-corp
    name: Monthly Invoice
    createdAt: "2026-01-20T09:00:00Z"
    lastModified: "2026-01-22T16:45:00Z"

DataExampleDto:
  type: object
  description: Named example data set for template testing
  required:
    - id
    - name
    - data
  properties:
    id:
      type: string
      description: Unique identifier of the data example
      example: standard-invoice
    name:
      type: string
      description: Display name of the data example
      example: Standard Invoice
    data:
      type: object
      description: The example data matching the template's data model
      example:
        customer:
          name: "Jane Smith"
          email: "jane.smith@example.com"
          taxId: "US123456789"
          address:
            street: "123 Main Street"
            city: "Springfield"
            postalCode: "62704"
            country: US
        invoiceNumber: "INV-2026-001"
        issueDate: "2026-02-01"
        dueDate: "2026-03-01"
        lineItems:
          - description: "Consulting Services (40h)"
            quantity: 40
            unitPrice: 150.00
            taxRate: 21
          - description: "Software License - Enterprise"
            quantity: 1
            unitPrice: 2500.00
            taxRate: 21
          - description: "Travel Expenses"
            quantity: 1
            unitPrice: 384.50
            taxRate: 0
        notes: "Payment due within 30 days. Please reference invoice number on transfer."
        currency: EUR
  example:
    id: standard-invoice
    name: Standard Invoice
    data:
      customer:
        name: "Jane Smith"
        email: "jane.smith@example.com"
        taxId: "US123456789"
        address:
          street: "123 Main Street"
          city: "Springfield"
          postalCode: "62704"
          country: US
      invoiceNumber: "INV-2026-001"
      issueDate: "2026-02-01"
      dueDate: "2026-03-01"
      lineItems:
        - description: "Consulting Services (40h)"
          quantity: 40
          unitPrice: 150.00
          taxRate: 21
        - description: "Software License - Enterprise"
          quantity: 1
          unitPrice: 2500.00
          taxRate: 21
        - description: "Travel Expenses"
          quantity: 1
          unitPrice: 384.50
          taxRate: 0
      notes: "Payment due within 30 days. Please reference invoice number on transfer."
      currency: EUR

CreateTemplateRequest:
  type: object
  description: Request body for creating a new template
  required:
    - id
    - name
  properties:
    id:
      type: string
      pattern: '^[a-z][a-z0-9]*(-[a-z0-9]+)*$'
      minLength: 3
      maxLength: 50
      description: Client-provided slug identifier for the template
      example: invoice
    name:
      type: string
      minLength: 1
      maxLength: 255
      description: Name of the template to create
      example: Monthly Invoice
    schema:
      type: object
      description: JSON Schema defining the input parameters for this template
      example:
        type: object
        required:
          - customer
          - invoiceNumber
          - issueDate
          - lineItems
        properties:
          customer:
            type: object
            required:
              - name
              - email
            properties:
              name:
                type: string
                minLength: 1
                maxLength: 200
              email:
                type: string
                format: email
              taxId:
                type: string
                pattern: "^[A-Z]{2}\\d{9}$"
              address:
                type: object
                properties:
                  street:
                    type: string
                  city:
                    type: string
                  postalCode:
                    type: string
                    pattern: "^\\d{5}(-\\d{4})?$"
                  country:
                    type: string
                    enum: [US, GB, NL, DE, FR]
          invoiceNumber:
            type: string
            pattern: "^INV-\\d{4}-\\d{3}$"
          issueDate:
            type: string
            format: date
          dueDate:
            type: string
            format: date
          lineItems:
            type: array
            minItems: 1
            items:
              type: object
              required:
                - description
                - quantity
                - unitPrice
              properties:
                description:
                  type: string
                quantity:
                  type: integer
                  minimum: 1
                unitPrice:
                  type: number
                  minimum: 0
                taxRate:
                  type: number
                  minimum: 0
                  maximum: 100
          notes:
            type: string
            maxLength: 1000
          currency:
            type: string
            enum: [USD, EUR, GBP]
            default: USD

UpdateTemplateRequest:
  type: object
  description: Request body for updating a template's metadata (all fields optional)
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 255
      description: New name for the template
      example: Monthly Invoice (Updated)
    schema:
      type: object
      additionalProperties: true
      description: Updated JSON Schema for input parameters
      example:
        type: object
        required:
          - customer
          - invoiceNumber
          - issueDate
          - lineItems
          - paymentMethod
        properties:
          customer:
            type: object
            required:
              - name
              - email
            properties:
              name:
                type: string
                minLength: 1
                maxLength: 200
              email:
                type: string
                format: email
              taxId:
                type: string
                pattern: "^[A-Z]{2}\\d{9}$"
              address:
                type: object
                properties:
                  street:
                    type: string
                  city:
                    type: string
                  postalCode:
                    type: string
                    pattern: "^\\d{5}(-\\d{4})?$"
                  country:
                    type: string
                    enum: [US, GB, NL, DE, FR]
          invoiceNumber:
            type: string
            pattern: "^INV-\\d{4}-\\d{3}$"
          issueDate:
            type: string
            format: date
          dueDate:
            type: string
            format: date
          lineItems:
            type: array
            minItems: 1
            items:
              type: object
              required:
                - description
                - quantity
                - unitPrice
              properties:
                description:
                  type: string
                quantity:
                  type: integer
                  minimum: 1
                unitPrice:
                  type: number
                  minimum: 0
                taxRate:
                  type: number
                  minimum: 0
                  maximum: 100
          paymentMethod:
            type: string
            enum: [bank-transfer, credit-card, paypal]
          notes:
            type: string
            maxLength: 1000
          currency:
            type: string
            enum: [USD, EUR, GBP]
            default: USD
    dataModel:
      type: object
      description: Updated data model schema
      example:
        type: object
        properties:
          header:
            type: object
            properties:
              logo:
                type: string
                format: uri
              companyName:
                type: string
              companyAddress:
                type: object
          summary:
            type: object
            properties:
              subtotal:
                type: number
              taxTotal:
                type: number
              total:
                type: number
          lineItems:
            type: array
            items:
              type: object
              properties:
                description:
                  type: string
                quantity:
                  type: integer
                unitPrice:
                  type: number
                lineTotal:
                  type: number
          footer:
            type: object
            properties:
              paymentTerms:
                type: string
              bankDetails:
                type: object
    dataExamples:
      type: array
      description: Updated data examples
      items:
        $ref: '#/DataExampleDto'
    forceUpdate:
      type: boolean
      default: false
      description: If true, save schema even if data examples don't match (returns warnings instead of errors)
      example: false

TemplateListResponse:
  type: object
  description: List of templates
  required:
    - items
  properties:
    items:
      type: array
      description: List of template summaries
      items:
        $ref: '#/TemplateSummaryDto'
  example:
    items:
      - id: invoice
        tenantId: acme-corp
        name: Monthly Invoice
        createdAt: "2026-01-20T09:00:00Z"
        lastModified: "2026-01-22T16:45:00Z"
